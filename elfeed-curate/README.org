#+TITLE:     elfeed-curate.el
#+AUTHOR:    Robert Nadler
#+EMAIL:     robert.nadler@gmail.com

* Description :unfold:

*elfeed-curate* is an add-on for [[https://github.com/skeeto/elfeed][elfeed]], an RSS reader for
Emacs.

The purpose of this package is to add the additional functionality needed to
curate RSS feeds. It provides the capability to annotate feed entries and to
publish entries grouped by their subject categories. =elfeed-curate= uses the
available =elfeed= search functionality for marking, tagging, and filtering of
feed entries. The new functions available to support the curation workflow are:

*** Entry annotation
- =elfeed-curate-edit-entry-annoation= (=a= key) adds the ability to create and
  edit annotation text to an entry. Annotations can have org mode formatting and
  are saved in the =elfeed= database. This function works in both search and
  show mode.
*** Entry selection
- =elfeed-curate-toggle-star= (=m= key) is a convenience function that allows
  starring entries from the show buffer. See [[https://pragmaticemacs.wordpress.com/2016/09/16/star-and-unstar-articles-in-elfeed/][Star and unstar articles in elfeed]].
*** Publication
- =elfeed-curate-export-entries= (=x= key) exports all entries in the
  =*elfeed-search*= buffer to the desired publication format (see
  =elfeed-curate-org-export-backend=). The newly generated file is also opened
  with the associated application (e.g. a browser for HTML). The subject categories
  are based on the entry tag names.
*** Utilities
- Use =M-x elfeed-curate-reconcile-annotations= to ensure all database entries
  have the correct annotation tags.

* Usage

- Include [[screenshots/screenshot.png]](s).

* Prerequisites

This package depends on =elfeed= being installed.

* Installation

If you use MELPA, an easy way to install this package is via
=package-install=. Alternatively, download =elfeed-curate.el=, put it in
your =load-path= and =require= it.

If you use both MELPA and =use-package=, you can use this, too:

#+begin_src emacs-lisp
(use-package elfeed-curate
  :ensure
  :after elfeed)
#+end_src

* Custom key bindings

The *annotate* function works in both search and show modes while
the *export* function works only in search mode.  The keys in
the =elfeed-search-mode-map= and =elfeed-show-mode-map= maps can
be bound as shown here:

#+begin_src emacs-lisp
(use-package elfeed-curate
  :ensure
  :bind (:map elfeed-search-mode-map
              ("a" . elfeed-curate-edit-entry-annoation)
              ("x" . elfeed-curate-export-entries))
        (:map elfeed-show-mode-map
              ("a" . elfeed-curate-edit-entry-annoation)
              ("m" . elfeed-curate-toggle-star)
              ("q" . kill-buffer-and-window)))
#+end_src

The [[https://github.com/doomemacs/doomemacs][Doom]] configuration would be:

*** =packages.el=
#+begin_src emacs-lisp
;;...
(package! elfeed-curate)
;;...
#+end_src

*** =config.el=
#+begin_src emacs-lisp
(after! elfeed
  ;; Your custom Elfeed configuration.
  ;; elfeed-curate key bindings:
  (define-key elfeed-search-mode-map "a" #'elfeed-curate-edit-entry-annoation)
  (define-key elfeed-search-mode-map "x" #'elfeed-curate-export-entries)
  (define-key elfeed-search-mode-map "m" #'elfeed-curate-toggle-star)

  (define-key elfeed-show-mode-map   "a" #'elfeed-curate-edit-entry-annoation)
  (define-key elfeed-show-mode-map   "m" #'elfeed-curate-toggle-star)
  (define-key elfeed-show-mode-map   "q" #'kill-buffer-and-window))
#+end_src
The show window =q= key override with =kill-buffer-and-window= seems to behave better than the default behavior (just
killing the buffer), but is optional. Your mileage may vary.

* Customization

Here are the variables that can be customized:

| Variable                                    | Default                                                                    | Desc.                                                                                                                                                         |
|---------------------------------------------+----------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------|
| =elfeed-curate-title-length=                | 60                                                                         | Maximum length of the entry title to show in the annotation edit buffer.                                                                                      |
| =elfeed-curate-annotation-key=              | :my/annotation                                                             | Elfeed database meta data key to store annotations.                                                                                                           |
| =elfeed-curate-annotation-tag=              | 'ann                                                                       | Tag used to indicate that annotation has been added to an entry.                                                                                              |
| =elfeed-curate-star-tag=                    | 'star                                                                      | Tag used to indicate that annotation has been `starred`.                                                                                                      |
| =elfeed-curate-no-group-tag=                | 'no_category                                                               | Tag used to indicate that an entry has no group tag. The entry will be added to this group in the export. Set to nil to not display these entries.            |
| =elfeed-curate-org-content-header-function= | #'elfeed-curate-org-content-header--default                                | Function used to create the header (options and title) content. The default is for HTML output.                                                               |
| =elfeed-curate-org-title=                   | Content of Note                                                            | The TITLE part of the '<Date> <Title>' format. See the =elfeed-curate-org-content-header--default= function.                                                  |
| =elfeed-curate-org-options=                 | #html-style:nil toc:nil num:nil f:nil html-postamble:nil html-preamble:nil | Set org document format options. Default is for an HTML export: no styles, TOC, section numbering, footer.                                                    |
| =elfeed-curate-export-dir=                  | ~/                                                                         | Export the org and html content to this directory.                                                                                                            |
| =elfeed-curate-org-export-backend=          | 'html                                                                      | Select export format. Can be one of:                                                                                                                          |
|                                             |                                                                            | =ascii= - Export to plain ASCII text.                                                                                                                         |
|                                             |                                                                            | =html= - Export to HTML.                                                                                                                                      |
|                                             |                                                                            | =md= - Export to Markdown.                                                                                                                                    |
|                                             |                                                                            | =odt= - Export to OpenDocument Text.                                                                                                                          |
|                                             |                                                                            | =pdf= - Export to PDF (requires additional setup).                                                                                                            |
| =elfeed-curate-group-exclude-tag-list=      | (list 'unread elfeed-curate-star-tag elfeed-curate-annotation-tag)         | List of tags to exclude from the group list. These are typically non-subject categories.                                                                      |
| =elfeed-curate-show-group-count=            | t                                                                          | Flag to enable showing the count of each group in the exported output. If a prefix argument is used before the export (=C-u x=), the count will not be shown. |
